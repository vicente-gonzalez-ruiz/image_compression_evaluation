default:	all

# Rules

## .gpt -> .fog
%.fig:	%.gpt
	gnuplot $*.gpt

## .fig -> .pdf
%.svg:	%.fig
	fig2dev -L pstex $*.fig > tmp.eps
	fig2dev -L pstex_t -f sf -p tmp.eps $< > tmp.tex
	latex << EOF \
\\documentclass{article} \
\\usepackage{epsfig} \
\\usepackage{amsmath} \
\\usepackage{amssymb} \
\\usepackage{color} \
\\begin{document} \
\\pagestyle{empty} \
\\thispagestyle{empty} \
\\resizebox{1.0\\textwidth}{!}{\\input{tmp}} \
\\end{document} \
EOF
	mv article.dvi $*.dvi
	dvips $*.dvi -o $*.ps
	ps2eps --loose < $*.ps > $*.eps
	epstopdf $*.eps
	rm $*.ps
	rm tmp.eps
	rm $*.dvi
	rm $*.eps
	rm tmp.tex
	rm article.aux
	rm article.log
	pdf2svg $*.pdf $*.svg

## .tex -> .svg
%.svg:	%.tex
	pdflatex -jobname $*_ << EOF \
\\documentclass{article} \
\\usepackage[utf8]{inputenc} \
\\usepackage{amsmath} \
\\usepackage{amssymb} \
\\usepackage{color} \
\\usepackage{listings} \
\\usepackage[pdftex]{graphicx} \
\\usepackage[urlcolor=black,colorlinks]{hyperref} \
\\begin{document} \
\\sffamily \
\\def\\normalfont{\\sffamily} \
\\renewcommand{\\familydefault}{cmss} \
\\pagestyle{empty} \
\\thispagestyle{empty} \
\\resizebox{1.0\\textwidth}{!}{\\input{$*}} \
\\end{document} \
EOF
#       pdftops $*_.pdf $*.ps
#       ps2eps --loose < $*.ps > $*.eps
#       epstopdf $*.eps
	pdfcrop $*_.pdf $*.pdf
	rm $*_.pdf
	rm $*_.aux
	rm $*_.log
	pdf2svg $*.pdf $*.svg

# Original files
FIGs := $(wildcard *.fig)
TEXs := $(wildcard *.tex)
GPTs := $(wildcard *.gpt)

# Temporal files
TMPs += $(FIGs:%.fig=%.svg)	# .svg files generated by .fig files
TMPs += $(TEXs:%.tex=%.svg)     # .svg files generated by .tex files
TMPs += $(GPTs:%.gpt=%.fig)     # .fig files generated by .gpt files

lena.png:
	wget http://www.hpca.ual.es/~vruiz/images/lena.png
TMPs += lena.png

lena.ppm:	lena.png
	convert lena.png lena.ppm
TMPs += lena.ppm

boats.png:
	wget http://www.hpca.ual.es/~vruiz/images/boats.png
TMPs += boats.png

boats.pgm:	boats.png
	convert boats.png boats.pgm
TMPs += boats.pgm

peppers.png:
	wget http://www.hpca.ual.es/~vruiz/images/peppers.png
TMPs += peppers.png

peppers.ppm:	peppers.png
	convert peppers.png peppers.ppm
TMPs += peppers.ppm

zelda.png:
	wget http://www.hpca.ual.es/~vruiz/images/zelda.png
TMPs += zelda.png

zelda.pgm:	zelda.png
	convert zelda.png zelda.pgm
TMPs += zelda.pgm

all:	$(TMPs)

clean:
	rm -f $(TMPs)

info:
	@echo $(TMPs)

